(function(t){function e(e){for(var s,r,o=e[0],c=e[1],l=e[2],f=0,d=[];f<o.length;f++)r=o[f],a[r]&&d.push(a[r][0]),a[r]=0;for(s in c)Object.prototype.hasOwnProperty.call(c,s)&&(t[s]=c[s]);u&&u(e);while(d.length)d.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],s=!0,o=1;o<n.length;o++){var c=n[o];0!==a[c]&&(s=!1)}s&&(i.splice(e--,1),t=r(r.s=n[0]))}return t}var s={},a={app:0},i=[];function r(e){if(s[e])return s[e].exports;var n=s[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=s,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)r.d(n,s,function(e){return t[e]}.bind(null,s));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=e,o=o.slice();for(var l=0;l<o.length;l++)e(o[l]);var u=c;i.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"0f28":function(t,e,n){},1:function(t,e){},2:function(t,e){},3:function(t,e){},"33b4":function(t,e,n){var s={"./Column.js":"dc34","./Hero.js":"c540","./index.js":"a3bc"};function a(t){var e=i(t);return n(e)}function i(t){var e=s[t];if(!(e+1)){var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}return e}a.keys=function(){return Object.keys(s)},a.resolve=i,t.exports=a,a.id="33b4"},4:function(t,e){},"56d7":function(t,e,n){"use strict";n.r(e);n("cadf"),n("551c"),n("097d");var s=n("a026"),a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("RouterView",{key:t.$route.fullPath})],1)},i=[],r=(n("a3bc"),{}),o=r,c=(n("cf25"),n("0c7c")),l=Object(c["a"])(o,a,i,!1,null,null,null),u=l.exports,f=(n("7f7f"),n("8c4f")),d=n("a0a1"),p=n("f499"),m=n.n(p),h=(n("386d"),n("7f61")),b={data:function(){return{lfm:null}},methods:{setUpLfm:function(){this.lfm=new h({api_key:d["a"],secret:d["b"]})}}},g={mixins:[b],data:function(){return{token:"",loading:!0}},mounted:function(){this.getTokenIfPresent()?(this.setUpLfm(),this.setNewSession()):this.loading=!1},methods:{getTokenIfPresent:function(){var t=new URLSearchParams(window.location.search),e=t.get("token");return this.token=e||"",!!this.token},setNewSession:function(){var t=this;this.lfm.authenticate(this.token,function(e,n){if(e)throw e;var s={};s.username=n.username,s.userkey=n.key,localStorage.setItem("session",m()(s)),t.goToLogged()})},goToLogged:function(){this.$router.push({name:"logged"})}}},v={props:["fit"],template:'<div class="main-container" :class="{fit: fit}">\n        <slot></slot>\n    </div>'};s["a"].component("hero",{template:"<p>huj</p>"});var k={name:"Start",mixins:[g],components:{Stage:v},data:function(){return{apiKey:d["a"]}},computed:{callbackUrl:function(){return location.origin+location.pathname}},template:'<Stage :fit="true">\n        <Hero title="Log Scrobbler"></Hero>         \n        <Column :vcentered="true">\n            <a :href="\'http://www.last.fm/api/auth/?api_key=\'+apiKey+\'&cb=\'+callbackUrl"\n                class="button is-link is-medium">\n                Log in with Lastfm\n            </a>\n        </Column>\n        <div class="pageloader" :class="{\'is-active\': loading}"></div>\n    </Stage>'},S=(n("ac6a"),{props:["lfm","tracks"],data:function(){return{success:null,sending:!1}},template:"<button v-if=\"tracks\" class=\"button\" @click=\"handleClick\"\n        :class=\"{\n            'is-danger': success === false,\n            'is-success': success === true,\n            'is-info': success === null,\n            'is-loading': sending\n            }\">\n        Scrobble checked\n     </button>",methods:{scrobbleSingle:function(t,e,n){this.lfm.track.scrobble({artist:t,track:e,timestamp:n},function(t,e){return t?(console.log(t),!1):(console.log("We have just scrobbled:",e),!0)})},scrobbleMultiple:function(t){var e=this;this.sending=!0;var n=!1;t.forEach(function(t){var s=e.scrobbleSingle(t.artist,t.track,t.timestamp);!1===s&&(n=!0)}),this.success=!n,this.sending=!1},handleClick:function(){this.tracks.length&&this.scrobbleMultiple(this.tracks)}}}),y={mixins:[b],data:function(){return{token:"",session:{}}},mounted:function(){this.setUpLfm(),this.recoverSession(),this.setSessionCredentials()},methods:{recoverSession:function(){var t=localStorage.getItem("session");t&&(this.session=JSON.parse(t))},setSessionCredentials:function(){this.lfm.setSessionCredentials(this.session.username,this.session.userkey)},logout:function(){localStorage.removeItem("session"),this.$router.push({name:"start"})}}},w=(n("28a5"),{props:["setTracks"],data:function(){return{file:null,fileContent:null,isLoading:!1}},watch:{file:function(t){var e=this;if(t){this.isLoading=!0;var n=new FileReader;n.readAsText(t),n.onload=function(t){e.fileContent=n.result}}},fileContent:function(t){t&&this.parseAndSetTracks()}},template:'<div class="file is-boxed is-centered element" :class="{\'is-loading\': isLoading}">\n        <label class="file-label">\n            <input class="file-input" @change="processFile" type="file" name="resume">\n            <span class="file-cta">\n            <span class="file-icon is-marginless">\n                <i class="fas fa-upload"></i>\n            </span>\n            <span class="file-label">\n                Choose .scrobbler.log file\n            </span>\n            </span>\n        </label>\n    </div>',methods:{processFile:function(t){this.file=t.target.files[0]},encodeHtml:function(t){var e=document.createElement("div");return e.innerHTML=t,e.innerHTML},parseAndSetTracks:function(){var t=this,e=/\r?\n/,n="&#x9;",s=this.fileContent.split(e),a=s.filter(function(t){return t&&"#"!=t.charAt(0)}),i=a.map(function(e){return e.split(t.encodeHtml(n))});setTimeout(function(){t.setTracks(i)},1e3)}}}),T=(n("6b54"),window.moment),x={name:"Manager",props:["initialTracks","lfm"],components:{Scrobbler:S},template:'<div class="table-container container">\n        <table class="table is-striped tracks-table">\n            <thead>\n                <tr>\n                    <th v-for="title in trackHeadings">{{title | capitalize}}</th>\n                </tr>\n            </thead>\n            <tbody>\n                <tr v-for="track in tracks">\n                    <template v-for="(prop, key) in track">\n                        <td v-if="key===\'accepted\'">\n                            <div class="field" @click="handleAccepted(track)">\n                                <input class="is-checkradio" type="checkbox" :checked="prop">\n                                <label></label>\n                            </div>\n                        </td>\n                        <td v-else-if="key!==\'timestamp\'">{{prop}}</td>\n                    </template>\n                </tr>\n            </tbody>\n        </table>\n        <div class="buttons is-right">\n            <Scrobbler :lfm="lfm" :tracks="tracksFormatted.filter(track=>track.accepted === true)" />\n        </div>\n    </div>\n    ',filters:{capitalize:function(t){return t?(t=t.toString(),t.charAt(0).toUpperCase()+t.slice(1)):""}},data:function(){return{trackHeadings:["artist","album","track","track num","length","accepted","time"],tracks:[]}},mounted:function(){this.tracks=this.tracksFormatted},computed:{tracksFormatted:function(){var t=this;return this.initialTracks.map(function(e,n){var s={};return t.trackHeadings.forEach(function(n,a){switch(n){case"length":s[n]=t.secondsToMinutesString(e[a]);break;case"accepted":s[n]=!!e[a];break;case"time":var i=e[a],r=i-7200;s["timestamp"]=r,s[n]=t.getTrackTimeFormatted(r);break;default:s[n]=e[a]}}),s})}},methods:{secondsToMinutesString:function(t){var e=Math.floor(t/60),n=t%60;return"".concat(e,":").concat(n)},getTrackTimeFormatted:function(t){return T.unix(t).format("DD.MM HH:mm")},handleAccepted:function(t){t.accepted=!t.accepted}}},L={name:"Logged",mixins:[y],components:{Scrobbler:S,Stage:v,FileInput:w,Manager:x},data:function(){return{actions:[{text:"Logout",function:this.logout}],tracks:[]}},computed:{username:function(){return this.session.username}},template:'<Stage :fit="!tracks.length">\n        <Hero title="Logged in as" :subtitle="username" :actions="actions"></Hero>\n        <Column :vcentered="!tracks.length">\n          <Manager v-if="tracks.length" :initialTracks="tracks" :lfm="lfm" />\n          <FileInput v-else :setTracks="setTracks" />\n        </Column>\n    </Stage>',mounted:function(){},methods:{test:function(){this.lfm.track.getInfo({artist:"Poli√ßa",track:"Wandering Star"},function(t,e){if(t)throw t;console.log(e)})},setTracks:function(t){this.tracks=t}}};s["a"].use(f["a"]);var C=new f["a"]({routes:[{path:"/",name:"start",component:k},{path:"/logged",name:"logged",component:L,meta:{requiresSession:!0}}]});C.beforeEach(function(t,e,n){t.matched.some(function(t){return t.meta.requiresSession})&&!localStorage.getItem("session")?n({name:"start"}):"start"===t.name&&localStorage.getItem("session")?n({name:"logged"}):n()});var M=C,j=n("2f62");s["a"].use(j["a"]);var O=new j["a"].Store({state:{},mutations:{},actions:{}});s["a"].config.productionTip=!1,new s["a"]({router:M,store:O,render:function(t){return t(u)}}).$mount("#app")},a0a1:function(t){t.exports={a:"f2131bd128a477ca7277ff8c3f33f65b",b:"543bba93bfcbbe685309c88eeb61f18c"}},a3bc:function(t,e,n){"use strict";n.r(e);n("a481"),n("ac6a"),n("cadf"),n("551c"),n("097d");var s=n("a026"),a=n("8103"),i=n.n(a),r=n("bba4"),o=n.n(r),c=n("33b4");c.keys().forEach(function(t){var e=c(t),n=i()(o()(t.replace(/^\.\/(.*)\.\w+$/,"$1")));s["a"].component(n,e.default||e)})},c540:function(t,e,n){"use strict";n.r(e),e["default"]={props:["title","subtitle","actions"],template:'<section class="hero is-primary">\n        <div class="hero-body">\n            <div class="container">\n                <div class="columns is-vcentered is-mobile">\n                    <div class="column">\n                        <h1 class="title">\n                            {{title}}\n                        </h1>\n                        <h2 v-if="subtitle" class="subtitle">\n                            {{subtitle}}\n                        </h2>\n                    </div>\n                    <div v-if="actions" class="column">\n                        <div class="buttons is-right">\n                            <span v-for="action in actions" @click="action.function" class="button">{{action.text}}</span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </section>'}},cf25:function(t,e,n){"use strict";var s=n("0f28"),a=n.n(s);a.a},dc34:function(t,e,n){"use strict";n.r(e),e["default"]={props:["vcentered"],template:'<div class="columns is-marginless f-grow" :class="{\'is-vcentered\': vcentered}">\n        <div class="column has-text-centered">\n            <slot></slot>\n        </div>\n    </div>'}}});
//# sourceMappingURL=app.5f2ab488.js.map